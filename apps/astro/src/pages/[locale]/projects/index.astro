---
import { Box, Container, Grid, GridItem, Stack, styled } from 'styled-system/jsx';
import { getMediaUrl } from 'utils/media';
import { Heading } from '~/components/ui/heading';
import { Link } from '~/components/ui/link';
import { Text } from '~/components/ui/text';
import { graphQLSdk } from '~/graphql';
import { useTranslations } from '~/i18n/utils';
import MainLayout from '~/layouts/MainLayout.astro';

export const prerender = false;

const { locale } = Astro.params;

//TODO:

const data = await graphQLSdk.fetchProjects({
  // locale
});

const projects = data?.projects?.data ?? [];

const t = useTranslations(locale as 'en');
---

<MainLayout>
  <Container maxW="breakpoint-xl">
    <Stack p="4" gap="4">
      <Heading as="h1" size="2xl" fontWeight="bold">{t('project.projects')}</Heading>
      <Grid gridTemplateColumns="repeat(auto-fit, minmax(200px, 1fr))">
        {
          projects.map((p) => {
            const { title, description, slug, media } = p.attributes ?? {};
            const image = media?.data?.[0]?.attributes;

            return (
              <GridItem>
                <Link href={`/${locale}/projects/${slug}`}>
                  <Stack>
                    {image && (
                      <Box borderRadius="l2" overflow="hidden">
                        <styled.img
                          src={getMediaUrl(image.url, {}, import.meta.env.PUBLIC_API_URL) ?? ''}
                          alt={image.name}
                          objectFit="cover"
                          objectPosition="center"
                          width="full"
                          aspectRatio="4 / 3"
                        />
                      </Box>
                    )}
                    <Text fontWeight="bold">{title}</Text>
                    <Text fontSize="sm">{description}</Text>
                  </Stack>
                </Link>
              </GridItem>
            );
          })
        }
      </Grid>
    </Stack>
  </Container>
</MainLayout>
